.\" Automatically generated by Pandoc 3.6.3
.\"
.TH "RK_CARGO_LLDB Reference" "" "" ""
.IP "1." 3
\f[CR]lldb target/debug/reap\f[R]
.IP "2." 3
\f[CR]process launch\f[R] (or
\f[CR]process launch \-i tests/data/grep.txt\f[R])
.SH Tests
To run a test in \f[CR]lldb\f[R] we first need the path to the compiled
test binary, which is printed out when \f[CR]cargo test\f[R] is run, it
looks like this:
.IP
.EX
target/debug/deps/<project\-name>\-d1d452730bf9464b
.EE
.PP
Note that \f[CR]cargo tests\f[R] runs \f[I]two test targets\f[R], one
for integration tests and one for unit tests, you\[cq]ll need to get the
path to the target that\[cq]s running the code you want to debug (e.g.,
either the test itself, or the project).
.IP \[bu] 2
Use \f[CR]rust\-lldb\f[R] for niceties like pretty printing (I
couldn\[cq]t get this to work with a non\-default \f[CR]lldb\f[R]
install location like on Linux).
.IP "1." 3
Run
\f[CR]rust\-lldb target/debug/deps/<project\-name>\-d1d452730bf9464b\f[R]
.IP "2." 3
Set breakpoints, e.g., \f[CR]b src/file.rs:20\f[R]
.IP "3." 3
In \f[CR]lldb\f[R] run \f[CR]run <test\-name>\f[R] (or
\f[CR]run \-\-test <test\-name>\f[R])
.SS Troubleshooting
.SH Installed
.IP "1." 3
\f[CR]cargo install \-\-path . \-\-debug\f[R]
.IP "2." 3
\f[CR]lldb .cargo/bin/reap\f[R]
.IP "3." 3
Set breakpoints, e.g., \f[CR]b src/file.rs:20\f[R]
.SH CLI Tests
CLI tests (e.g., using \f[CR]Command::cargo_bin(\[dq]rep\[dq])\f[R])
involve two different binaries, one is the CLI binary, and the other is
the test binary.
You can use the normal method above for the test binary, but for the CLI
binary, you\[cq]ll need to do some extra steps to add
\f[CR]get\-task\-allow\f[R].
.IP "1." 3
Add the \f[CR]get\-task\-allow\f[R] flag to the binary (this is the
built binaries path, e.g., \f[CR]target/debug/rep\f[R], which
doesn\[cq]t appear in the \f[CR]cargo test\f[R] compilation output)
.IP "2." 3
\f[CR]rust\-lldb\f[R]
.IP "3." 3
\f[CR](lldb) process attach \-n <binary\-name> \-w\f[R] (\f[CR]\-n\f[R]:
\f[CR]\-\-name\f[R], \f[CR]\-w\f[R]: \f[CR]\-\-waitfor\f[R])
.IP "4." 3
\f[CR]cargo test <test\-name>\f[R]
.RS 4
.IP \[bu] 2
\f[I]Note you have to be sure this doesn\[cq]t overwrite the binary by
re\-compiling\f[R]
.IP \[bu] 2
\f[CR]<test\-name>\f[R] seems to be required for this to work for some
reason
.RE
.IP "5." 3
When the test starts running the debugger will immediately pause
execution, and then breakpoints can be entered,
e.g.\ \f[CR]b /Users/robenkleene/Developer/Projects/CLI/rep\-grep/src/patcher.rs:24\f[R],
then follow\-up with \f[CR]c\f[R] for continue to hit the breakpoint
.SS \f[CR]get\-task\-allow\f[R]
.SS Adding
\f[CR]=(...)\f[R] is special \f[CR]zsh\f[R] process substitution that
creates a temporary file containing the output of the command, and then
uses that temporary file as the parameter.
.IP
.EX
codesign \-s \- \-v \-f \-\-entitlements =(echo \-n \[aq]<?xml version=\[dq]1.0\[dq] encoding=\[dq]UTF\-8\[dq]?>
<!DOCTYPE plist PUBLIC \[dq]\-//Apple//DTD PLIST 1.0//EN\[dq] \[dq]https://www.apple.com/DTDs/PropertyList\-1.0.dtd\[dq]\[rs]>
<plist version=\[dq]1.0\[dq]>
    <dict>
        <key>com.apple.security.get\-task\-allow</key>
        <true/>
    </dict>
</plist>\[aq]) <binary\-path>
.EE
.SS Verifying
\f[CR]codesign \-dvvv \-\-entitlements=\- <path\-to\-app>\f[R]
