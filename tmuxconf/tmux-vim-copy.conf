# emacs
bind-key -T copy-mode-vi Space send-keys -X page-down
bind-key -T copy-mode-vi BSpace send-keys -X page-up
bind-key -T copy-mode-vi NPage send-keys -X page-down
bind-key -T copy-mode-vi PPage send-keys -X page-up

# vim
bind-key -T copy-mode-vi q if -F "#{selection_present}" { send-keys -X pipe-and-cancel "safecopy" } { send -X cancel }
bind-key -T copy-mode-vi p if -F "#{selection_present}" {
    send-keys -X copy-pipe-and-cancel "safecopy"
    paste-buffer -p -s' '
} {
    send -X cancel
}
bind-key -T copy-mode-vi Enter if -F "#{selection_present}" {
    send-keys -X copy-pipe-and-cancel "safecopy"
    paste-buffer -p -s' '
} {
    send -X search-backward-text " "
    send-keys -X cursor-right
    send-keys -X begin-selection
    send -X search-forward-text " "
    send-keys -X cursor-left
    send-key -X rectangle-on
    send-key -X rectangle-off
}
bind-key -T copy-mode-vi Escape if-shell -Ft= "#{selection_active}" {
    send-keys -X clear-selection
} {
    send-keys -X cancel
}
# Search
bind-key -T copy-mode-vi / command-prompt -i -p "search down" "send -X search-forward-incremental \"%%%\""
bind-key -T copy-mode-vi ? command-prompt -i -p "search up" "send -X search-backward-incremental \"%%%\""

# Copy
bind-key -T copy-mode-vi v send-keys -X rectangle-off \; send-keys -X begin-selection
bind-key -T copy-mode-vi C-v send-key -X rectangle-on \; send-keys -X begin-selection
bind-key -T copy-mode-vi y send-keys -X pipe "safecopy"
# bind-key -T copy-mode-vi a send-keys -X pipe "safecopy -a"
bind-key -T copy-mode-vi A send-keys -X pipe "safecopy -a"

# Motions
bind-key -T copy-mode-vi g switch-client -T copy-mode-vi-g
bind-key -T copy-mode-vi-g _ send-keys -X end-of-line \; send-keys -X cursor-left
bind-key -T copy-mode-vi-g g send-keys -X history-top
# Just use simpler `less`-style bindings
# Don't do this, in `less` `b` and `f` are bound to page up and down, which
# conflicts with basic vim bindings
# bind-key -T copy-mode-vi g send-keys -X history-top

bind-key [ copy-mode \; \
        send-key -X start-of-line \; \
        send -X search-backward " " \; \
        send-key -X rectangle-on \; \
        send-key -X rectangle-off \; \
        send-key -X start-of-line
bind-key -T copy-mode-vi [ \
        send-key -X start-of-line \; \
        send -X search-backward " " \; \
        send-key -X rectangle-on \; \
        send-key -X rectangle-off \; \
        send-key -X start-of-line
bind-key -T copy-mode-vi ] \
        send-key -X end-of-line \; \
        send -X search-forward " " \; \
        send-key -X rectangle-on \; \
        send-key -X rectangle-off \; \
        send-key -X start-of-line

# i
# Hard to make these look nice because the search term gets highlighted
bind-key -T copy-mode-vi i switch-client -T copy-mode-vi-i
bind-key -T copy-mode-vi-i w {
        send -X search-backward-text " "
        send-keys -X cursor-right
        send-keys -X begin-selection
        send -X search-forward-text " "
        send-keys -X cursor-left
        send-key -X rectangle-on
        send-key -X rectangle-off
}
bind-key -T copy-mode-vi-i W {
        send -X search-backward-text " "
        send-keys -X cursor-right
        send-keys -X begin-selection
        send -X search-forward-text " "
        send-keys -X cursor-left
        send-key -X rectangle-on
        send-key -X rectangle-off
}
bind-key -T copy-mode-vi-i ` {
        send -X search-backward-text "`"
        send-keys -X cursor-right
        send-keys -X begin-selection
        send -X search-forward-text "`"
        send-keys -X cursor-left
        send-key -X rectangle-on
        send-key -X rectangle-off
}
bind-key -T copy-mode-vi-i \" {
        send -X search-backward-text "\""
        send-keys -X cursor-right
        send-keys -X begin-selection
        send -X search-forward-text "\""
        send-keys -X cursor-left
        send-key -X rectangle-on
        send-key -X rectangle-off
}
bind-key -T copy-mode-vi-i \' {
        send -X search-backward-text "\'"
        send-keys -X cursor-right
        send-keys -X begin-selection
        send -X search-forward-text "\'"
        send-keys -X cursor-left
        send-key -X rectangle-on
        send-key -X rectangle-off
}
bind-key -T copy-mode-vi-i [ {
        send -X search-backward-text "["
        send-keys -X cursor-right
        send-keys -X begin-selection
        send -X search-forward-text "]"
        send-keys -X cursor-left
        send-key -X rectangle-on
        send-key -X rectangle-off
}
bind-key -T copy-mode-vi-i ] {
        send -X search-backward-text "["
        send-keys -X cursor-right
        send-keys -X begin-selection
        send -X search-forward-text "]"
        send-keys -X cursor-left
        send-key -X rectangle-on
        send-key -X rectangle-off
}
bind-key -T copy-mode-vi-i ( {
        send -X search-backward-text "\("
        send-keys -X cursor-right
        send-keys -X begin-selection
        send -X search-forward-text ")"
        send-keys -X cursor-left
        send-key -X rectangle-on
        send-key -X rectangle-off
}
bind-key -T copy-mode-vi-i ) {
        send -X search-backward-text "("
        send-keys -X cursor-right
        send-keys -X begin-selection
        send -X search-forward-text ")"
        send-keys -X cursor-left
        send-key -X rectangle-on
        send-key -X rectangle-off
}
bind-key -T copy-mode-vi-i \{ {
        send -X search-backward-text "{"
        send-keys -X cursor-right
        send-keys -X begin-selection
        send -X search-forward-text "}"
        send-keys -X cursor-left
        send-key -X rectangle-on
        send-key -X rectangle-off
}
bind-key -T copy-mode-vi-i \} {
        send -X search-backward-text "{"
        send-keys -X cursor-right
        send-keys -X begin-selection
        send -X search-forward-text "}"
        send-keys -X cursor-left
        send-key -X rectangle-on
        send-key -X rectangle-off
}
